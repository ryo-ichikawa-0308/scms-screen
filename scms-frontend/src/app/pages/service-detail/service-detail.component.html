<mat-card class="detail-card">
    <mat-card-header class="dialog-header">
        <mat-card-title>{{ detail()?.name || 'サービス詳細' }}</mat-card-title>
        <button mat-icon-button (click)="dialogRef.close()" class="close-button">
            <mat-icon>close</mat-icon>
        </button>
    </mat-card-header>
    <mat-card-content class="dialog-content">
        @if (isLoading()) {
            <div class="loading-area"><mat-icon class="spinner">autorenew</mat-icon> 読み込み中...</div>
        } @else if (detail()) {
            <div class="detail-info">
                <p><strong>価格:</strong> ¥{{ detail()!.price | number }}</p>
                <p><strong>在庫:</strong> <span [class.out-of-stock]="detail()!.stock === 0">{{ detail()!.stock }}</span></p>
                <p class="description">{{ detail()!.description }}</p>
            </div>

            <mat-form-field appearance="outline" class="full-width margin-top">
                <mat-label>注文数</mat-label>
                <!-- 注文数スピンボックス -->
                <input 
                    matInput 
                    type="number" 
                    [(ngModel)]="orderQuantity" 
                    [min]="1" 
                    [max]="detail()!.stock" 
                    name="orderQuantity"
                    [disabled]="detail()!.stock === 0">
                @if (detail()!.stock > 0) {
                    <mat-hint>1〜{{ detail()!.stock }}の間で指定してください。</mat-hint>
                } @else {
                    <mat-hint class="hint-error">在庫がありません。</mat-hint>
                }
            </mat-form-field>

            @if (contractMessage()) {
                <div [class.success-message]="isContractSuccess()" [class.error-message]="!isContractSuccess()" class="message-box">
                    {{ contractMessage() }}
                </div>
            }

        } @else {
            <p class="error-message">サービスが見つかりませんでした。</p>
        }
    </mat-card-content>
    <mat-card-actions class="dialog-actions">
        <button 
            mat-raised-button 
            color="accent" 
            [disabled]="isLoading() || isProcessing() || !detail() || detail()!.stock === 0 || orderQuantity < 1 || orderQuantity > detail()!.stock || isContractSuccess()"
            (click)="executeContract()">
            @if (isProcessing()) {
                <mat-icon class="spinner">autorenew</mat-icon>
            }
            契約する
        </button>
        <button mat-button (click)="dialogRef.close()">閉じる</button>
    </mat-card-actions>
</mat-card>